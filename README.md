# Honeytrap

![Honeytrap](/public/assets/honeytrap_header_960.png)

Honeytrap is a premium Nostr PWA focused on deep reading and clean navigation. The main feed is a fast, vertical, virtualized stream. A post expands into a dedicated thread view (root‑to‑reply stack), and an author opens an author view (profile + author feed). Optional WebTorrent assist adds redundancy for media/event packages with HTTP fallback.

## Highlights
- **Vertical, virtualized feed** with manual refresh and pull‑to‑refresh on touch.
- **Thread view** that presents a root‑to‑reply stack (no truncation, actions, reply composer).
- **Author view** with full profile header and author‑only feed.
- **Transport status icons** per post (Relay / P2P / HTTP / Verified).
- **Safety controls**: NSFW blurring + per‑author NSFW override, follow/block controls.
- **Optional P2P assist**: WebTorrent media/event support with SHA‑256 verification.

## Run
```bash
npm install
npm run dev
```

## Build
```bash
npm run build
npm run preview
```

## Navigation
- **Feed**: vertical and manual only (no auto‑scroll). Pull‑to‑refresh loads pending items on touch devices.
- **Thread view**: `/thread/:id` shows the root‑to‑reply stack and actions.
- **Author view**: `/author/:pubkey` shows profile + author feed.

## Login & Identity
- **NIP‑07** browser extension
- **NIP‑46** bunker / nostrconnect (QR supported)
- **Nsec paste** (unsafe, stored locally)

## Nostr Support (current)
- **Notes**: kind `1`
- **Long‑form**: kind `30023` (title + summary in feed, no truncation in thread)
- **Zaps**: NIP‑57 request + NWC payment flow
- **Relay list**: NIP‑65 (kind `10002`) used when available
- **nostr: links**: `npub/nprofile` rendered as chips; `nevent/note` rendered as nested cards when available

## Media + P2P Assist
Honeytrap can prefer WebTorrent for media/event packages, with strict verification and HTTP fallback.

- **Media tags**
  - `['bt', '<magnet-uri>', 'media', 'url=<http-url>']`
  - `['x', 'sha256:<hex>', 'url=<http-url>']`
- **Event packages**
  - `['bt', '<magnet-uri>', 'event']`
  - `['x', 'sha256:<hex>', 'event']`

### Canonical event bytes
`canonicaliseEvent(event)` outputs deterministic UTF‑8 bytes (stable key order, no whitespace) for SHA‑256 validation.

## Settings & Controls
- **Nostr relays** (NIP‑65 aware + live status)
- **Media relays** (Blossom defaults)
- **BitTorrent assist** (scope, trackers, concurrency)
- **Wallet** (NWC URI + zap presets)
- **Feed filter** (Follows / Following / Both / All)

## PWA & WASM
- PWA manifest + service worker are generated by `vite-plugin-pwa`.
- Icons include maskable PNGs for install prompts.
- WASM module boundary lives in `src/wasm/` for future helpers (no WASM binary bundled yet).

## UI Notes
- **Main feed cards** show author + content + first media/link only. **More** opens the thread view.
- **NSFW blur** is driven by tags and can be overridden per author.
- **Follow/Block** actions are available on each card and on author pages.

## Structure
- `src/nostr/` – Nostr protocol/services (OO)
- `src/p2p/` – WebTorrent + verification
- `src/storage/` – IndexedDB settings/cache
- `src/ui/` – components, routes, layout

## Known Limitations
- No DMs
- Reposts/likes/share are UI only (not wired)
- Author lists/tracklists are not exposed in the UI yet
- Event‑package assist is opportunistic and never a source of truth
