@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  *, *::before, *::after {
    box-sizing: border-box;
  }

  :root {
    color-scheme: dark;
  }

  html, body, #root {
    @apply h-full w-full max-w-full;
  }

  @supports (height: 100dvh) {
    html, body, #root {
      height: 100dvh;
    }
    .app-shell {
      min-height: 100dvh;
    }
  }

  button {
    @apply bg-transparent border-none p-0 cursor-pointer text-inherit font-[inherit] outline-none;
  }

  body {
    @apply m-0 min-h-full w-full max-w-full overflow-x-hidden;
    background: radial-gradient(1000px 600px at 15% 20%, rgba(56, 121, 255, 0.08), transparent),
      radial-gradient(900px 500px at 85% 10%, rgba(100, 255, 226, 0.06), transparent),
      #0b0d10;
  }
}

@layer components {
  .app-shell {
    @apply h-full w-full max-w-full text-accent overflow-x-hidden;
    padding-top: calc(58px + env(safe-area-inset-top));
    transition: padding-top 180ms ease;
  }

  body.mobile-header-hidden .app-shell {
    padding-top: env(safe-area-inset-top);
  }

  .page-header-root {
    @apply flex items-center gap-4 mb-5;
  }

  .page-header-content {
    @apply grid gap-1;
  }

  .page-header-title {
    @apply inline-flex items-center gap-2.5 font-display text-xl font-semibold;
  }

  .page-header-subtitle {
    @apply text-sm text-muted;
  }

  .page-header-icon {
    @apply text-glow flex;
  }

  .form-group-root {
    @apply grid gap-2 w-full;
  }

  .feed-virtuoso {
    @apply flex-auto h-auto min-h-0 px-4 py-3 pb-6 max-w-full overflow-x-hidden;
  }

  .feed-shell {
    @apply h-full relative flex flex-col overscroll-contain max-w-full;
  }

  .progress-line {
    @apply absolute top-0 left-0 right-0 h-[3px] scale-x-0 origin-left opacity-0 transition-all duration-[160ms] z-[5] will-change-[transform,opacity];
    background: linear-gradient(90deg, rgba(109, 214, 255, 0.0), rgba(109, 214, 255, 0.9), rgba(109, 214, 255, 0.0));
  }

  @media (min-width: 1280px) {
    .progress-line {
      @apply h-1;
    }
  }

  .progress-line.active {
    @apply opacity-100 scale-x-100 animate-[feed-progress_1.2s_ease-in-out_infinite];
  }

  .progress-line.pulse {
    @apply animate-[feed-progress_0.9s_ease-in-out_infinite];
  }

  .feed-pull {
    @apply absolute top-0 left-0 right-0 h-0 flex items-end justify-center pointer-events-none text-muted-dark text-[11px] tracking-[0.12em] uppercase transition-[height] duration-[160ms];
  }

  .feed-pull span {
    @apply pb-2;
  }

  .feed-pull.ready {
    @apply text-glow;
  }

  .feed-item {
    @apply flex justify-center py-3 max-w-full w-full;
  }

  .feed-row {
    display: grid;
    gap: 16px;
    width: 100%;
    align-items: start;
    padding: 0 4px;
    margin-bottom: 16px;
  }

  .feed-grid-item {
    @apply flex justify-center w-full;
    /* Isolate each item's layout so height changes don't propagate to sibling
       items or the Virtuoso scroller, preventing scroll-position jumps. */
    contain: layout;
  }

  .post-card {
    @apply w-full max-w-full box-border mx-auto rounded-3xl p-[20px_22px] shadow-[0_24px_50px_rgba(0,0,0,0.35)] grid gap-4 [backface-visibility:hidden] [transform:translateZ(0)];
    background-color: #11151b;
    border: 1px solid #1b222c;
    /* Use layout+style containment only — avoid paint containment which can clip
       shadows, and avoid content-visibility:auto which causes scroll jumps when
       the browser's intrinsic-size estimate (400px) differs from actual height. */
    contain: layout style;
    min-height: 200px;
    align-content: start;
    align-items: start;
  }

  .post-card--placeholder {
    min-height: 240px;
    background: linear-gradient(110deg, #10161d 10%, #17202a 45%, #10161d 80%);
    background-size: 220% 100%;
    border-color: #1f2a36;
    animation: feed-placeholder-scan 1.2s ease-in-out infinite;
  }

  @media (prefers-reduced-motion: reduce) {
    .post-card--placeholder {
      animation: none;
    }
  }

  @media (max-width: 767px) {
    .post-card {
      @apply w-[min(720px,92vw)] max-w-[calc(100vw-32px)];
    }
  }

  /* Multi-column feed: enforce per-row card parity so varying content lengths
     don't produce a ragged, disorganized grid. */
  @media (min-width: 768px) {
    .feed-row {
      align-items: stretch;
    }

    .feed-grid-item {
      align-self: stretch;
    }

    .post-card {
      height: 100%;
    }

    .post-card > .post-actions:last-child {
      margin-top: auto;
    }
  }

  .post-card.depth-1 { background-color: #111820; }
  .post-card.depth-2 { background-color: #121c26; }
  .post-card.depth-3 { background-color: #13202c; }
  .post-card.depth-4 { background-color: #142432; }
  .post-card.depth-5 { background-color: #152838; }
  .post-card.depth-6 { background-color: #162c3e; }

  .post-header {
    @apply flex justify-between items-start gap-3 flex-wrap;
  }

  .post-author {
    @apply flex items-start gap-3 min-w-0 flex-auto flex-wrap;
  }

  .author-actions {
    @apply inline-flex gap-1.5 ml-2 flex-wrap self-start;
  }

  .post-avatar {
    @apply w-11 h-11 rounded-full object-cover bg-[#1b222c];
  }

  .post-avatar.placeholder {
    @apply bg-[#1b222c];
  }

  .post-avatar.fallback {
    @apply border border-[#1b222c];
  }

  .post-name {
    @apply font-display text-base font-semibold max-w-full overflow-hidden text-ellipsis whitespace-nowrap text-left;
  }

  .post-time {
    @apply text-xs text-muted;
  }

  .post-icons {
    @apply flex gap-2 flex-wrap justify-end items-start self-start;
  }

  .icon-button {
    @apply w-7 h-7 rounded-[10px] grid place-items-center text-[#9aa9bf] opacity-60;
    border: 1px solid #1b222c;
    background-color: rgba(11, 13, 16, 0.6);
  }

  .icon-button--static {
    @apply pointer-events-auto cursor-default;
  }

  .icon-button--neon {
    background-color: rgba(11, 13, 16, 0.7);
    border-color: rgba(109, 214, 255, 0.35);
    @apply text-glow shadow-neon;
  }

  .icon-button--author {
    background-color: rgba(11, 13, 16, 0.6);
  }

  .icon-button.is-active {
    @apply opacity-100 shadow-neon-strong;
  }

  .icon-button.is-relay.is-active {
    @apply text-[#7dd3fc];
    border-color: rgba(125, 211, 252, 0.6);
  }

  .icon-button.is-p2p.is-active {
    @apply text-[#86efac] shadow-[0_0_18px_rgba(134,239,172,0.4)];
    border-color: rgba(134, 239, 172, 0.6);
  }

  .icon-button.is-http.is-active {
    @apply text-[#facc15] shadow-[0_0_18px_rgba(250,204,21,0.4)];
    border-color: rgba(250, 204, 21, 0.6);
  }

  .icon-button.is-verified.is-active {
    @apply text-[#a78bfa] shadow-[0_0_18px_rgba(167,139,250,0.4)];
    border-color: rgba(167, 139, 250, 0.6);
  }

  .icon-button.is-follow.is-active {
    @apply text-[#86efac] shadow-[0_0_12px_rgba(134,239,172,0.35)];
    border-color: rgba(134, 239, 172, 0.6);
  }

  .icon-button.is-block.is-active {
    @apply text-[#f87171] shadow-[0_0_12px_rgba(248,113,113,0.35)];
    border-color: rgba(248, 113, 113, 0.6);
  }

  .icon-button.is-nsfw.is-active {
    @apply text-[#fbbf24] shadow-[0_0_12px_rgba(251,191,36,0.35)];
    border-color: rgba(251, 191, 36, 0.7);
  }

  .post-content.collapsed {
    @apply max-h-[220px] overflow-hidden;
  }

  .post-content.expanded {
    @apply max-h-none overflow-visible;
  }

  .nsfw-blur {
    @apply blur-2xl pointer-events-none;
  }

  .nsfw-reveal {
    @apply text-[#fca5a5] rounded-full px-3 py-1.5 text-xs self-start;
    background-color: rgba(11, 13, 16, 0.7);
    border: 1px solid rgba(248, 113, 113, 0.5);
  }

  .post-text {
    @apply text-base leading-[1.6] text-[#e2e8f0] break-words [overflow-wrap:anywhere];
  }

  .post-title {
    @apply font-display text-xl font-semibold;
  }

  .post-media {
    @apply grid gap-3;
  }

  .post-media-shell {
    @apply relative w-full max-w-full p-0 rounded-2xl overflow-hidden aspect-[4/5] cursor-zoom-in;
    background-color: rgba(11, 13, 16, 0.7);
    border: 1px solid #1b222c;
  }

  .post-media-shell.video {
    @apply aspect-video;
  }

  .post-media-shell::after {
    @apply content-[''] absolute inset-0 opacity-60;
    background: linear-gradient(120deg, rgba(26, 34, 45, 0.7), rgba(16, 22, 30, 0.4), rgba(26, 34, 45, 0.7));
  }

  .post-media-shell.loaded::after {
    @apply opacity-0 animate-none;
  }

  .post-media-item {
    @apply w-full h-full object-contain block opacity-0 transition-opacity duration-200;
  }

  .post-media-shell.image .post-media-item {
    @apply object-contain;
    background-color: rgba(11, 13, 16, 0.92);
  }

  .post-media-shell.video .post-media-item {
    @apply object-cover;
  }

  .post-media-shell.loaded .post-media-item {
    @apply opacity-100;
  }

  .post-links {
    @apply grid gap-2.5;
  }

  .link-preview {
    @apply grid gap-1 p-3 px-3.5 rounded-2xl text-[#d7e0ed] no-underline;
    background-color: rgba(11, 13, 16, 0.6);
    border: 1px solid #1b222c;
    min-height: 60px;
  }

  .link-host {
    @apply text-[12px] tracking-[0.08em] uppercase text-muted;
  }

  .link-path {
    @apply text-[13px] text-[#e2e8f0] break-words;
  }

  .nostr-chip {
    @apply inline-flex items-center gap-1.5 rounded-full px-2.5 py-1 mx-1 text-[#b9e6ff] text-[12px];
    background-color: rgba(11, 13, 16, 0.8);
    border: 1px solid rgba(109, 214, 255, 0.45);
  }

  .hashtag-link {
    @apply inline-flex items-center rounded-full px-2 py-0.5 mx-0.5 text-[#7dd3fc] text-[12px] cursor-pointer;
    background-color: rgba(11, 13, 16, 0.65);
    border: 1px solid rgba(109, 214, 255, 0.35);
  }

  .post-custom-emoji {
    @apply w-[1.35em] h-[1.35em] m-0 mx-[0.08em] align-[-0.28em] object-contain rounded-[4px];
  }

  .nested-card {
    @apply rounded-2xl p-2.5 px-3 my-2;
    background-color: rgba(12, 16, 22, 0.7);
    border: 1px solid #1b222c;
  }

  .nested-title {
    @apply text-[11px] tracking-[0.08em] uppercase text-muted-dark mb-1.5;
  }

  .post-more {
    @apply inline-flex items-center gap-1.5 rounded-full px-3 py-1.5 text-[12px] text-[#d1dae6];
    background-color: rgba(11, 13, 16, 0.8);
    border: 1px solid #1b222c;
  }

  .mobile-header-bar {
    @apply fixed top-0 left-0 right-0 h-[calc(58px+env(safe-area-inset-top))] p-[calc(8px+env(safe-area-inset-top))_12px_8px] z-40 flex justify-between items-center gap-2.5 backdrop-blur-xl;
    background: linear-gradient(180deg, rgba(11, 13, 16, 0.95), rgba(11, 13, 16, 0.88));
    border-bottom: 1px solid #1b222c;
    transition: transform 180ms ease, opacity 160ms ease, border-color 180ms ease;
    will-change: transform;
  }

  .mobile-header-bar.is-hidden {
    transform: translateY(calc(-100% - 6px));
    opacity: 0.98;
    border-bottom-color: transparent;
    pointer-events: none;
  }

  .mobile-header-menu {
    @apply rounded-full text-[#d7e0ed] inline-flex items-center gap-2 px-3 py-2 text-[11px] tracking-[0.12em] uppercase;
    background-color: rgba(11, 13, 16, 0.8);
    border: 1px solid #1b222c;
  }

  .mobile-header-menu-pill {
    background-color: rgba(109, 214, 255, 0.65);
    @apply w-[22px] h-1.5 rounded-full;
  }

  .mobile-profile-chip {
    @apply rounded-full text-[#d7e0ed] inline-flex items-center gap-2 min-w-0 max-w-[min(58vw,280px)] p-[6px_10px_6px_6px];
    background-color: rgba(11, 13, 16, 0.82);
    border: 1px solid #1b222c;
  }

  .mobile-profile-chip.guest {
    border-color: rgba(109, 214, 255, 0.35);
    @apply text-[#b9e6ff];
  }

  .mobile-profile-avatar {
    @apply w-[30px] h-[30px] rounded-full object-cover bg-[#1b222c] border border-[#1b222c];
  }

  .mobile-profile-avatar.fallback {
    border-color: rgba(109, 214, 255, 0.25);
  }

  .mobile-profile-name {
    @apply text-[12px] font-semibold truncate;
  }

  .top-drawer {
    @apply fixed top-0 left-0 right-0 z-50 -translate-y-[110%] transition-transform duration-[240ms] p-[18px_20px_26px] shadow-[0_20px_60px_rgba(0,0,0,0.5)] backdrop-blur-2xl max-h-screen overflow-y-auto overscroll-contain max-w-full;
    background-color: rgba(11, 13, 16, 0.95);
    border-bottom: 1px solid #1b222c;
    -webkit-overflow-scrolling: touch;
  }

  @supports (height: 100dvh) {
    .top-drawer {
      @apply max-h-[100dvh];
    }
  }

  .drawer-close {
    @apply absolute top-3 right-3 w-8 h-8 rounded-full border border-[#1b222c] text-[#d1dae6] grid place-items-center z-[5];
    background-color: rgba(11, 13, 16, 0.8);
  }

  .top-drawer.open {
    @apply translate-y-0;
  }

  .menu-banner {
    @apply w-full rounded-2xl overflow-hidden border border-[#1b222c] mb-3;
  }

  .menu-banner img {
    @apply w-full h-auto block;
  }

  .drawer-version {
    @apply m-[-2px_2px_10px] text-[11px] tracking-[0.08em] uppercase text-[#6f8099];
  }

  @media (min-width: 1200px) {
    .app-shell {
      @apply pl-80 pt-0;
    }

    .mobile-header-bar {
      @apply hidden;
    }

    .top-drawer {
      @apply right-auto bottom-0 w-80 h-screen -translate-x-[110%] transition-transform duration-[240ms] border-b-0;
      border-right: 1px solid #1b222c;
    }

    .top-drawer.open {
      @apply translate-x-0;
    }

    .drawer-backdrop {
      @apply hidden;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .app-shell {
      transition: none;
    }

    .mobile-header-bar {
      transition: none;
    }
  }

  .drawer-backdrop {
    background-color: rgba(6, 8, 12, 0.55);
    @apply fixed inset-0 backdrop-blur-[2px] z-[45];
  }

  .drawer-section {
    @apply grid gap-3 py-3;
    border-bottom: 1px solid #1b222c;
  }

  .drawer-section:last-child {
    @apply border-b-0;
  }

  .drawer-title {
    @apply font-display text-[13px] tracking-[0.12em] uppercase text-muted flex items-center gap-2;
  }

  .drawer-author {
    @apply flex items-center gap-3 p-[6px_8px] rounded-xl transition-[0.15s] text-left w-full;
  }

  .drawer-author:active {
    background-color: rgba(11, 13, 16, 0.5);
    box-shadow: inset 0 0 0 1px rgba(109, 214, 255, 0.4);
  }

  .drawer-avatar {
    @apply w-12 h-12 rounded-full object-cover;
    background-color: #1b222c;
  }

  .drawer-avatar.placeholder {
    background-color: #1b222c;
  }

  .drawer-avatar.fallback {
    border: 1px solid #1b222c;
  }

  .drawer-name {
    @apply text-base font-semibold;
  }

  .drawer-sub {
    @apply text-xs text-[#8b9bb4];
  }

  .drawer-row {
    @apply grid gap-2;
  }

  .drawer-label {
    @apply inline-flex items-center gap-1.5 text-xs text-[#b4c0d4];
  }

  .drawer-actions {
    @apply flex gap-2 flex-wrap;
  }

  .drawer-textarea,
  .drawer-input {
    @apply w-full rounded-xl text-accent p-2 py-2.5 text-xs;
    background-color: rgba(11, 13, 16, 0.8);
    border: 1px solid #1b222c;
  }

  .drawer-warning {
    @apply text-[11px] text-[#fca5a5];
  }

  .drawer-qr {
    @apply flex justify-center py-2;
  }

  .drawer-button {
    @apply inline-flex items-center gap-1.5 border border-[#1b222c] rounded-full p-1.5 px-3 text-xs text-[#d1dae6];
    background-color: rgba(11, 13, 16, 0.8);
  }

  .drawer-button--saved {
    border-color: rgba(109, 214, 255, 0.8);
    @apply text-glow shadow-neon;
  }

  .menu-stack {
    @apply grid gap-3.5;
  }

  .menu-section {
    @apply grid gap-2.5 py-3;
    border-bottom: 1px solid #1b222c;
    min-width: 0;
  }

  .menu-section summary {
    @apply list-none cursor-pointer;
  }

  .menu-section summary::-webkit-details-marker {
    @apply hidden;
  }

  .menu-section:last-child {
    @apply border-b-0;
  }

  .menu-section-title {
    @apply font-display text-xs tracking-[0.12em] uppercase text-muted flex items-center gap-2;
  }

  .menu-section-icon {
    @apply w-6 h-6 rounded-[10px] grid place-items-center text-[#7ed2ff];
    border: 1px solid rgba(109, 214, 255, 0.4);
  }

  .menu-section-body {
    @apply grid gap-2.5;
    min-width: 0;
  }

  .menu-label {
    @apply text-xs text-[#b4c0d4] inline-flex items-center gap-1.5;
    min-width: 0;
    overflow-wrap: anywhere;
  }

  .menu-sub {
    @apply text-xs text-[#8b9bb4];
    min-width: 0;
    overflow-wrap: anywhere;
  }

  .menu-row {
    @apply flex flex-wrap gap-2 items-center;
    min-width: 0;
    align-items: flex-start;
  }

  .menu-pill-row {
    @apply flex flex-wrap gap-2 mt-1.5;
  }

  .menu-pill {
    @apply inline-flex items-center gap-1.5 rounded-full border border-[#1b222c] text-[#cbd5e1] p-1.5 px-3 text-xs;
    background-color: rgba(11, 13, 16, 0.7);
  }

  .menu-pill.active {
    border-color: rgba(109, 214, 255, 0.7);
    @apply text-glow shadow-[0_0_14px_rgba(109,214,255,0.3)];
  }

  .menu-pill-count {
    @apply inline-flex items-center justify-center min-w-[22px] h-[22px] rounded-full border border-[#1b222c] text-[11px] text-muted;
    background-color: rgba(15, 23, 42, 0.8);
  }

  .relay-status-list {
    @apply grid gap-1.5 text-[11px] text-[#9aa9bf];
  }

  .relay-status {
    @apply inline-flex items-center gap-2 p-1.5 px-2.5 rounded-xl border border-[#1b222c];
    background-color: rgba(11, 13, 16, 0.6);
  }

  .relay-status.ok {
    border-color: rgba(134, 239, 172, 0.5);
    @apply text-[#86efac];
  }

  .relay-status.bad {
    border-color: rgba(248, 113, 113, 0.5);
    @apply text-[#f87171];
  }

  .relay-dot {
    @apply w-2 h-2 rounded-full bg-current shadow-[0_0_6px_currentColor];
  }

  .menu-input,
  .menu-select,
  .menu-textarea {
    @apply w-full rounded-xl border border-[#1b222c] text-accent p-2 py-2.5 text-xs;
    background-color: rgba(11, 13, 16, 0.8);
  }

  .menu-textarea {
    @apply min-h-[70px];
  }

  .menu-toggle-row {
    @apply grid gap-2;
    min-width: 0;
  }

  .menu-toggle {
    @apply inline-flex items-center gap-2 text-xs text-[#cdd7e4];
    min-width: 0;
    overflow-wrap: anywhere;
  }

  .menu-button {
    @apply inline-flex items-center gap-1.5 border border-[#1b222c] rounded-full p-1.5 px-3 py-[7px] text-xs text-[#d1dae6];
    background-color: rgba(11, 13, 16, 0.8);
  }

  .menu-button--saved {
    border-color: rgba(109, 214, 255, 0.8);
    @apply text-glow shadow-neon;
  }

  .menu-button.danger {
    border-color: rgba(248, 113, 113, 0.5);
    @apply text-[#fca5a5];
  }

  .torrent-list {
    @apply grid gap-2;
    min-width: 0;
  }

  .torrent-list-items {
    @apply grid gap-2;
    min-width: 0;
  }

  .torrent-item {
    @apply border border-[#1b222c] rounded-xl p-2 px-2.5;
    background-color: rgba(11, 13, 16, 0.55);
    min-width: 0;
  }

  .torrent-item.inactive {
    @apply opacity-75;
  }

  .torrent-item-row {
    @apply flex items-center gap-2 min-w-0;
    overflow: hidden;
  }

  .torrent-name {
    @apply text-xs text-[#d6e0f0] truncate flex-1 min-w-0;
  }

  .torrent-meta {
    @apply flex flex-wrap gap-2.5 text-[11px] text-[#8b9bb4] mt-1 items-center;
    min-width: 0;
  }

  .torrent-chip {
    @apply text-[10px] uppercase tracking-[0.1em] p-[3px] px-1.5 rounded-full border border-[#1b222c] text-[#9aa9bf];
  }

  .torrent-chip.seed {
    border-color: rgba(134, 239, 172, 0.5);
    @apply text-[#86efac];
  }

  .torrent-chip.fetch {
    border-color: rgba(125, 211, 252, 0.5);
    @apply text-[#7dd3fc];
  }

  .torrent-reseed {
    border-color: rgba(109, 214, 255, 0.4);
    @apply ml-auto text-glow rounded-full px-2 py-0.5 text-[10px] transition-all duration-200;
    background-color: rgba(11, 13, 16, 0.5);
  }

  .torrent-reseed:disabled {
    @apply opacity-50 cursor-not-allowed;
  }

  .torrent-reseed.active {
    border-color: rgba(134, 239, 172, 0.6);
    @apply text-[#86efac] shadow-[0_0_12px_rgba(134,239,172,0.4)];
  }

  .thread-stack {
    @apply h-screen p-20 px-4 py-6 pb-6 relative max-w-full;
  }

  @supports (height: 100dvh) {
    .thread-stack {
      @apply h-[100dvh];
    }
  }

  .thread-virtuoso {
    @apply h-full;
  }

  .thread-item {
    @apply flex justify-center py-3;
  }

  .thread-empty {
    @apply p-6 text-center text-muted-dark;
  }

  .author-view {
    @apply h-full block relative max-w-full;
  }

  .author-header {
    @apply p-6 px-4 pb-3 grid gap-3 justify-items-center;
  }

  .author-back {
    @apply w-9 h-9 rounded-full border border-[#1b222c] text-[#c9d3e0] grid place-items-center;
    background-color: rgba(11, 13, 16, 0.8);
  }

  .author-card-root {
    @apply flex gap-3.5 items-start p-4 w-[min(720px,92vw)];
  }

  .author-avatar {
    @apply w-16 h-16 rounded-full object-cover bg-[#1b222c] flex-shrink-0;
  }

  .author-avatar.fallback {
    @apply border border-[#1b222c] grid place-items-center text-[#7ed2ff];
  }

  .author-name {
    @apply font-display text-lg font-semibold;
  }

  .author-sub {
    @apply text-xs text-muted break-all;
  }

  .author-about {
    @apply mt-1.5 text-[13px] text-[#cbd5e1] leading-[1.5];
  }

  .author-stats {
    @apply mt-2 flex gap-3.5 flex-wrap text-xs text-[#9bb1c9];
  }

  .author-meta {
    @apply mt-2.5 flex flex-wrap gap-2;
  }

  .author-meta-item {
    @apply inline-flex items-center gap-1.5 border border-[#1b222c] rounded-full p-[5px] px-2.5 text-xs text-[#bfd0e6] no-underline;
    background-color: rgba(11, 13, 16, 0.7);
  }

  .author-controls {
    @apply mt-2.5 inline-flex gap-2;
  }

  .author-empty {
    @apply p-6 text-center text-muted-dark;
  }

  .thread-close {
    @apply fixed right-5 top-[18px] z-[60] border border-[#1b222c] text-[#d9e1ec] rounded-full w-9 h-9 grid place-items-center;
    background-color: rgba(11, 13, 16, 0.8);
  }

  .post-actions {
    @apply grid grid-cols-5 gap-2 items-center pt-2.5;
    border-top: 1px solid rgba(27, 34, 44, 0.9);
    background: linear-gradient(180deg, rgba(8, 12, 18, 0), rgba(8, 12, 18, 0.28));
  }

  .action-icon {
    @apply w-8 h-8 rounded-[10px] text-[#8fdcff] grid place-items-center transition-all duration-200 justify-self-center;
    background-color: rgba(11, 13, 16, 0.6);
    border: 1px solid rgba(109, 214, 255, 0.35);
  }

  .action-icon:disabled {
    @apply opacity-50 cursor-not-allowed;
  }

  .action-icon.is-active {
    @apply shadow-[0_0_14px_rgba(109,214,255,0.35)] opacity-100;
  }

  .action-icon.is-like.is-active {
    @apply text-[#f472b6] shadow-[0_0_16px_rgba(244,114,182,0.4)];
    border-color: rgba(244, 114, 182, 0.6);
  }

  .action-icon.is-repost.is-active {
    @apply text-[#86efac] shadow-[0_0_16px_rgba(134,239,172,0.4)];
    border-color: rgba(134, 239, 172, 0.6);
  }

  .action-icon.is-share.is-active {
    @apply text-[#facc15] shadow-[0_0_16px_rgba(250,204,21,0.4)];
    border-color: rgba(250, 204, 21, 0.6);
  }

  .composer-backdrop {
    background-color: rgba(6, 8, 12, 0.68);
    @apply fixed inset-0 backdrop-blur-[6px] z-[70] grid place-items-center p-5;
  }

  .composer-panel {
    @apply w-[min(640px,92vw)] bg-[#0f141b] border border-[#1b222c] rounded-[20px] p-[18px_20px] grid gap-3.5 shadow-[0_30px_80px_rgba(0,0,0,0.45)];
  }

  .composer-header {
    @apply flex items-center justify-between;
  }

  .composer-title {
    @apply font-display text-[15px] tracking-[0.08em] uppercase text-[#9bb1c9];
  }

  .composer-close {
    @apply w-8 h-8 rounded-full border border-[#1b222c] text-[#c9d3e0] grid place-items-center;
    background-color: rgba(11, 13, 16, 0.8);
  }

  .composer-reply {
    @apply text-xs text-muted-dark;
  }

  .composer-error {
    @apply text-xs text-[#fca5a5];
  }

  .composer-textarea {
    @apply rounded-2xl border border-[#1b222c] text-accent p-3 px-3.5 text-[14px] leading-[1.5] resize-y;
    background-color: rgba(11, 13, 16, 0.8);
  }

  .composer-media {
    @apply grid gap-2.5 border-t border-[#1b222c] pt-2.5;
  }

  .composer-row {
    @apply grid gap-1.5;
  }

  .composer-row-inline {
    @apply grid grid-cols-[1fr_auto] gap-2 items-center;
  }

  .composer-select {
    @apply w-full rounded-xl border border-[#1b222c] text-accent p-2 text-xs;
    background-color: rgba(11, 13, 16, 0.8);
  }

  .composer-file {
    @apply hidden;
  }

  .composer-sub {
    @apply text-[11px] text-muted-dark mt-1.5;
  }

  .composer-icon {
    @apply w-8 h-8 rounded-[10px] border border-[#1b222c] text-[#9fb4cc] grid place-items-center;
    background-color: rgba(11, 13, 16, 0.8);
  }

  .composer-icon.active {
    border-color: rgba(109, 214, 255, 0.7);
    @apply text-glow shadow-[0_0_12px_rgba(109,214,255,0.25)];
  }

  .composer-progress {
    @apply h-1 rounded-full border border-[#1b222c] overflow-hidden mt-1.5;
    background-color: rgba(15, 23, 42, 0.7);
  }

  .composer-progress-bar {
    @apply h-full transition-all duration-[120ms];
    background: linear-gradient(90deg, rgba(109, 214, 255, 0.4), rgba(109, 214, 255, 0.95));
  }

  .composer-button {
    @apply inline-flex items-center justify-center gap-1.5 border border-[#1b222c] rounded-full p-2 px-3.5 text-xs text-[#d1dae6];
    background-color: rgba(11, 13, 16, 0.8);
  }

  .composer-button.primary {
    border-color: rgba(109, 214, 255, 0.7);
    @apply text-glow shadow-[0_0_18px_rgba(109,214,255,0.25)];
  }

  .composer-button[disabled] {
    @apply opacity-60 cursor-not-allowed;
  }

  .composer-media-list {
    @apply grid gap-1.5 text-[11px] text-muted-dark;
  }

  .composer-media-chip {
    @apply grid grid-cols-[1fr_auto] gap-2 items-center border border-[#1b222c] rounded-xl p-1.5 px-2.5 break-all;
    background-color: rgba(11, 13, 16, 0.7);
  }

  .zap-backdrop {
    background-color: rgba(6, 8, 12, 0.7);
    @apply fixed inset-0 backdrop-blur-[6px] z-[70] grid place-items-center p-5;
  }

  .zap-panel {
    @apply w-[min(520px,92vw)] bg-[#0f141b] border border-[#1b222c] rounded-[20px] p-[18px_20px] grid gap-3 shadow-[0_30px_80px_rgba(0,0,0,0.45)];
  }

  .zap-header {
    @apply flex items-center justify-between;
  }

  .zap-title {
    @apply font-display text-[15px] tracking-[0.08em] uppercase text-[#9bb1c9];
  }

  .zap-close {
    @apply w-8 h-8 rounded-full border border-[#1b222c] text-[#c9d3e0] grid place-items-center;
    background-color: rgba(11, 13, 16, 0.8);
  }

  .zap-presets {
    @apply flex flex-wrap gap-2;
  }

  .zap-chip {
    @apply inline-flex items-center gap-1.5 rounded-full p-1.5 px-3 text-xs text-[#cfe9ff];
    background-color: rgba(11, 13, 16, 0.7);
    border: 1px solid rgba(109, 214, 255, 0.35);
  }

  .zap-chip.active {
    border-color: rgba(109, 214, 255, 0.8);
    @apply text-glow shadow-neon;
  }

  .zap-label {
    @apply text-xs text-[#b4c0d4];
  }

  .zap-input,
  .zap-textarea {
    @apply w-full rounded-xl border border-[#1b222c] text-accent p-2 py-2 text-xs;
    background-color: rgba(11, 13, 16, 0.8);
  }

  .zap-error {
    @apply text-xs text-[#fca5a5];
  }

  .zap-send {
    @apply rounded-full p-2 px-3.5 text-xs text-glow shadow-[0_0_18px_rgba(109,214,255,0.25)];
    background-color: rgba(11, 13, 16, 0.85);
    border: 1px solid rgba(109, 214, 255, 0.7);
  }

  .zap-send[disabled] {
    @apply opacity-60 cursor-not-allowed;
  }

  .fab-button {
    @apply fixed right-5 bottom-[calc(20px+env(safe-area-inset-bottom))] w-14 h-14 rounded-full text-glow grid place-items-center shadow-[0_18px_40px_rgba(0,0,0,0.45),0_0_20px_rgba(109,214,255,0.25)] z-[65] transition-all duration-[160ms];
    background-color: rgba(10, 16, 24, 0.9);
    border: 1px solid rgba(109, 214, 255, 0.5);
  }

  .fab-button:hover {
    @apply -translate-y-0.5 scale-[1.02] shadow-[0_20px_44px_rgba(0,0,0,0.5),0_0_26px_rgba(109,214,255,0.35)];
    border-color: rgba(109, 214, 255, 0.85);
  }

  /* ── P2P Status Bar ─────────────────────────────────────────── */
  .p2p-bar {
    @apply fixed bottom-[calc(16px+env(safe-area-inset-bottom))] left-4 z-[40] flex items-center gap-2 p-1 px-2.5 rounded-[20px] text-[11px] font-mono tracking-[0.04em] backdrop-blur-sm transition-all duration-300 pointer-events-none select-none;
    background: rgba(11, 13, 16, 0.85);
    border: 1px solid rgba(109, 214, 255, 0.12);
  }

  @media (min-width: 1200px) {
    .p2p-bar {
      @apply left-[336px];
    }
  }

  .p2p-bar--dormant {
    @apply opacity-30 text-[#4a6070];
  }

  .p2p-bar--idle {
    @apply opacity-60 text-glow;
    border-color: rgba(109, 214, 255, 0.2);
  }

  .p2p-bar--active {
    @apply opacity-100 text-glow shadow-[0_0_12px_rgba(109,214,255,0.08)];
    border-color: rgba(109, 214, 255, 0.4);
  }

  .p2p-bar__hex {
    @apply shrink-0 text-current;
  }

  .p2p-bar__nodes {
    @apply flex items-center gap-1 font-semibold;
  }

  .p2p-bar__divider {
    @apply w-px h-3 shrink-0;
    background-color: rgba(109, 214, 255, 0.2);
  }

  .p2p-bar__label {
    @apply opacity-70;
  }

  .p2p-bar__stat {
    @apply flex items-center gap-0.5;
  }

  .p2p-bar__stat--fetch { @apply text-glow; }
  .p2p-bar__stat--seed  { @apply text-[#64ffb4]; }

  .p2p-bar__arrow {
    @apply text-[10px] opacity-80;
  }

  .p2p-bar__pulse {
    @apply w-1.5 h-1.5 rounded-full bg-glow shrink-0 animate-[p2p-pulse_1.4s_ease-in-out_infinite];
  }

  @keyframes p2p-pulse {
    0%, 100% { @apply opacity-100 scale-100; box-shadow: 0 0 0 0 rgba(109, 214, 255, 0.5); }
    50%       { @apply opacity-60 scale-[0.85]; box-shadow: 0 0 0 4px rgba(109, 214, 255, 0); }
  }

  /* ── Per-post P2P active bolt ───────────────────────────────── */
  .icon-btn--p2p-live {
    @apply animate-[bolt-glow_1.8s_ease-in-out_infinite];
  }

  @keyframes bolt-glow {
    0%, 100% { filter: drop-shadow(0 0 0px rgba(109, 214, 255, 0)); @apply opacity-90; }
    50%       { filter: drop-shadow(0 0 4px rgba(109, 214, 255, 0.9)); @apply opacity-100; }
  }

  .feed-toolbar {
    @apply relative m-[12px_auto_8px] w-full max-w-[calc(100vw-32px)] flex flex-wrap items-center justify-between gap-3 z-[8] px-4;
  }

  @media (min-width: 1200px) {
    .feed-toolbar {
      @apply max-w-[1200px];
    }
  }

  .feed-mode-switcher {
    @apply flex items-center gap-1.5 flex-wrap;
  }

  .feed-mode-pill,
  .feed-search-button,
  .feed-pending-button,
  .feed-empty-action {
    @apply border border-[#1b222c] rounded-full text-[#d5deeb] text-xs p-1.5 px-3;
    background-color: rgba(11, 13, 16, 0.82);
  }

  .feed-mode-pill.active {
    border-color: rgba(109, 214, 255, 0.8);
    @apply text-glow shadow-[0_0_12px_rgba(109,214,255,0.25)];
  }

  .feed-search-button {
    @apply justify-self-start;
  }

  .feed-pending-button {
    border-color: rgba(109, 214, 255, 0.7);
    @apply text-glow shadow-[0_0_16px_rgba(109,214,255,0.25)];
  }

  .feed-toolbar-actions {
    @apply flex gap-2 flex-wrap;
  }

  .feed-empty-state {
    @apply m-[120px_auto_0] w-[min(620px,calc(100vw-28px))] border border-[#1b222c] rounded-[22px] p-[18px] grid gap-2.5 text-center;
    background-color: rgba(12, 17, 24, 0.85);
  }

  .feed-empty-title {
    @apply font-display text-lg;
  }

  .feed-empty-copy {
    @apply text-[13px] text-[#9fb2c8];
  }

  .author-banner {
    @apply w-[min(720px,92vw)] rounded-[18px] overflow-hidden border border-[#1b222c];
  }

  .author-banner img {
    @apply w-full max-h-[220px] object-cover block;
  }

  .author-meta-item:hover {
    background-color: rgba(109, 214, 255, 0.1);
    border-color: rgba(109, 214, 255, 0.3);
  }

  .post-context-layer {
    @apply fixed inset-0 z-[90];
  }

  .post-context-menu {
    @apply fixed w-[196px] border border-[#1b222c] rounded-2xl p-1.5 grid gap-1;
    background-color: rgba(9, 12, 18, 0.96);
  }

  .post-context-item {
    @apply border-none rounded-xl bg-transparent text-[#d6e0f0] text-xs text-left p-2 px-2.5 inline-flex items-center gap-[7px];
  }

  .post-context-item:hover {
    background-color: rgba(109, 214, 255, 0.12);
  }

  .post-toast {
    @apply fixed left-1/2 bottom-[calc(16px+env(safe-area-inset-bottom))] -translate-x-1/2 border border-[#1b222c] rounded-full p-[7px] px-3 text-xs text-[#d2dcea] z-[92];
    background-color: rgba(11, 13, 16, 0.92);
  }

  .media-lightbox {
    @apply fixed inset-0 z-[88] grid place-items-center;
    background-color: rgba(4, 7, 10, 0.94);
  }

  .media-lightbox-stage {
    @apply w-[min(94vw,1200px)] h-[min(84vh,860px)] grid place-items-center overflow-hidden;
  }

  .media-lightbox-item {
    @apply max-w-full max-h-full object-contain transition-transform duration-[140ms];
  }

  .media-lightbox-close,
  .media-lightbox-nav,
  .media-lightbox-tool {
    @apply border border-[#1b222c] rounded-full w-[38px] h-[38px] grid place-items-center text-[#d6e0f0];
    background-color: rgba(11, 13, 16, 0.9);
  }

  .media-lightbox-close {
    @apply absolute top-4 right-4;
  }

  .media-lightbox-nav {
    @apply absolute top-1/2 -translate-y-1/2;
  }

  .media-lightbox-nav.prev { @apply left-4; }
  .media-lightbox-nav.next { @apply right-4; }

  .media-lightbox-zoom {
    @apply absolute bottom-4 left-1/2 -translate-x-1/2 inline-flex items-center gap-2.5 border border-[#1b222c] rounded-full p-1 px-2.5 text-xs;
    background-color: rgba(11, 13, 16, 0.9);
  }

  .media-lightbox-count {
    @apply absolute top-[18px] left-5 text-[#9eb2ca] text-xs;
  }

  .search-view,
  .notifications-view,
  .profile-edit-view,
  .lists-view,
  .longform-view {
    @apply h-full overflow-y-auto p-[88px_16px_24px];
  }

  .search-header,
  .notifications-header,
  .profile-edit-header {
    @apply w-[min(760px,calc(100vw-26px))] mx-auto mb-3.5 grid gap-1.5;
  }

  .search-title,
  .notifications-title {
    @apply inline-flex items-center gap-2 font-display text-xl;
  }

  .search-sub,
  .notifications-sub {
    @apply text-[13px] text-[#97acc4];
  }

  .search-form,
  .search-results,
  .profile-edit-form {
    @apply w-[min(760px,calc(100vw-26px))] mx-auto mb-3.5 border border-[#1b222c] rounded-[18px] p-3.5 grid gap-2.5;
    background-color: rgba(12, 17, 24, 0.82);
  }

  .search-label {
    @apply text-xs text-[#a9bdd5];
  }

  .search-row {
    @apply grid grid-cols-[1fr_auto] gap-2;
  }

  .search-input,
  .profile-edit-textarea {
    @apply w-full rounded-xl border border-[#1b222c] text-accent p-[9px_10px] text-[13px];
    background-color: rgba(11, 13, 16, 0.82);
  }

  .profile-edit-textarea {
    @apply min-h-[100px] resize-y;
  }

  .search-section-title {
    @apply text-[11px] tracking-[0.1em] uppercase text-muted-dark mb-1;
  }

  .search-result {
    @apply w-full border border-[#1b222c] rounded-2xl text-accent p-2.5 grid grid-cols-[auto_1fr] gap-2.5 items-start text-left;
    background-color: rgba(8, 12, 18, 0.68);
  }

  .search-result.static {
    @apply cursor-default;
  }

  .search-result-title {
    @apply text-[13px] font-semibold;
  }

  .search-result-sub {
    @apply text-[11px] text-muted-dark truncate;
  }

  .search-error {
    @apply w-[min(760px,calc(100vw-26px))] mx-auto text-xs text-[#fca5a5] mb-3.5;
  }

  .longform-shell {
    @apply w-[min(800px,94vw)] mx-auto;
  }

  .longform-header-back {
    @apply mb-4;
  }

  .longform-card {
    @apply bg-[#11151b] border border-[#1b222c] rounded-[24px] p-6 grid gap-5 shadow-[0_24px_60px_rgba(0,0,0,0.4)];
  }

  .longform-hero {
    @apply w-full h-auto max-h-[400px] object-cover rounded-2xl border border-[#1b222c];
  }

  .longform-title {
    @apply font-display text-3xl font-semibold leading-[1.2] text-accent;
  }

  .longform-meta {
    @apply flex items-center gap-3.5 text-xs text-muted;
  }

  .longform-author {
    @apply text-glow font-semibold hover:underline;
  }

  .longform-summary {
    @apply text-lg text-[#cbd5e1] leading-[1.6] italic border-l-2 pl-4;
    border-left-color: rgba(109, 214, 255, 0.4);
  }

  .longform-markdown {
    @apply text-base leading-[1.7] text-[#e2e8f0] grid gap-5;
  }

  .longform-markdown h1 { @apply text-2xl font-semibold font-display border-b border-[#1b222c] pb-2; }
  .longform-markdown h2 { @apply text-xl font-semibold font-display; }
  .longform-markdown h3 { @apply text-lg font-semibold font-display; }
  .longform-markdown p { @apply break-words; }
  .longform-markdown ul { @apply list-disc pl-5 grid gap-2; }
  .longform-markdown blockquote { @apply border-l-4 border-[#1b222c] pl-4 text-muted italic; }
  .longform-markdown pre { @apply p-4 rounded-xl border border-[#1b222c] overflow-x-auto; background-color: rgba(11, 13, 16, 0.8); }
  .longform-markdown code { @apply font-mono text-sm p-[2px_4px] rounded; background-color: rgba(11, 13, 16, 0.4); }
  .longform-markdown a { @apply text-glow hover:underline; }
  .longform-markdown hr { @apply border-t border-[#1b222c] my-2; }
}

@keyframes shimmer {
  0% { background-position: 0% 0%; }
  100% { background-position: 200% 0%; }
}

@keyframes feed-progress {
  0% { opacity: 0.35; }
  50% { opacity: 1; }
  100% { opacity: 0.35; }
}

@keyframes feed-placeholder-scan {
  0% { background-position: 0% 0%; }
  100% { background-position: 200% 0%; }
}
